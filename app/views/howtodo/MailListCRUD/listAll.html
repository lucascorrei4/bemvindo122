#{extends 'CRUD/layoutPub.html' /}
#{set title:messages.get('crud.list.title', type.name) /}
<meta charset="utf-8" />
	<div class="row">
		<div class="col-lg-12">
			<div class="col-lg-6">
				#{crud.searchAll /}
			</div>
			<div class="col-lg-6">
			</div>
		</div>
	</div>
	<div class="col-lg-12 ${type.name}">
		<div class="panel panel-default">
            <div class="panel-heading">
                Todos os Leads
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <!-- Nav tabs -->
                <ul class="nav nav-pills">
                    <li class="active"><a href="#item1" data-toggle="tab" aria-expanded="true">Desempenho</a>
                    </li>
                    <li class=""><a href="#item2" data-toggle="tab" aria-expanded="false">Ranking de Captura</a>
                    </li>
                    <li><a href="#item3" data-toggle="tab">Todos</a>
                    </li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <div class="tab-pane fade active in" id="item1">
                        <h4>Home Tab</h4>
                        <div class="panel panel-default">
	                       <div class="panel-heading">
	                           <i class="fa fa-bar-chart-o fa-fw"></i><strong>Leads</strong> por Período
	                       </div>
	                       <div class="panel-body">
	                           <div id="morris-donut-chart"></div>
	                       </div>
	                   	</div>
                    </div>
                    <div class="tab-pane fade" id="item2">
                        <h4>TOP 10 - Ranking de Captura de Leads</h4>
                        <div class="panel panel-default">
				            <div class="panel-heading">
				                <h5 class="text-info">Páginas que atraem mais leads</h5>
				            </div>
				            <div class="panel-body">
				                <div class="table-responsive">
				                    <table class="table table-striped">
				                        <thead>
				                            <tr>
				                                <th>#</th>
				                                <th>Página</th>
				                                <th>Tipo de Conteúdo</th>
				                                <th>Qtd. Leads</th>
				                            </tr>
				                        </thead>
				                        <tbody>
				                        	#{list leadsByPage, as:'leadPage'}
				                             <tr>
				                                 <td>${leadPage_index}</td>
				                                 <td><a href="${leadPage[1]}" target="_blank">${leadPage[1]}</a></td>
				                                 <td><a href="${leadPage[1]}" target="_blank">${leadPage[2] == null ? 'Não especificado' : leadPage[2]}</a></td>
				                                 <td>${leadPage[0]}</td>
				                             </tr>
				                         #{/list}
				                        </tbody>
				                    </table>
				                </div>
				            </div>
				        </div>
                    </div>
                    <div class="tab-pane fade" id="item3">
                    	<h4>Tabela de Leads</h4>
                        <div class="panel panel-default">
				            <div class="panel-heading"></div>
				            <div class="panel-body">
				            	<div class="dataTable_wrapper">
							        #{crud.table fields:['postedAt', 'name', 'mail', 'origin', 'url', 'typeContentPage', 'isActive', 'action']}
								        #{crud.custom 'postedAt'}
							         		<a href="@{howtodo.MailListCRUD.show(object.id)}">${object.postedAtParsed}</a>
								        #{/crud.custom}
								        #{crud.custom 'name'}
							         		<a href="@{howtodo.MailListCRUD.show(object.id)}">${object.name}</a>
								        #{/crud.custom}
								        #{crud.custom 'mail'}
							         		<a href="@{howtodo.MailListCRUD.show(object.id)}">${object.mail}</a>
								        #{/crud.custom}
								        #{crud.custom 'isActive'}
							         		<a href="@{howtodo.MailListCRUD.show(object.id)}">${object.isActive?'Sim':'Não'}</a>
								        #{/crud.custom}
								        #{crud.custom 'typeContentPage'}
							         		<a href="@{howtodo.MailListCRUD.show(object.id)}">${object.typeContentPage?.label}</a>
								        #{/crud.custom}
								        #{crud.custom 'action'}
				                            <a href="@{howtodo.MailListCRUD.remove(object.id)}" title="Atenção: Esta ação remove o ítem.">Remover</a>
								        #{/crud.custom}
								    #{/crud.table}
				    				<div class="alert alert-info alert-dismissable" style="margin: 5px">
										#{crud.paginationAll /}
					   				</div>
				   				</div>
				   			</div>
				   			<div class="col-lg-6"></div>
				   		</div>
                    </div>
                </div>
            </div>
        </div>
   	</div>
<script>
  	$(function() {
	    Morris.Donut({
	        element: 'morris-donut-chart',
	        data: ${rankingLeads.raw()},
	        resize: true
	    });
	});
  </script>